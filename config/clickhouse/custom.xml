<!-- ClickHouse 自定义配置 / ClickHouse Custom Configuration -->
<clickhouse>
    <!-- 日志配置 / Logging Configuration -->
    <logger>
        <level>information</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <size>100M</size>
        <count>5</count>
    </logger>

    <!-- 查询日志 / Query Log -->
    <query_log>
        <database>system</database>
        <table>query_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>

    <!-- 性能配置 / Performance Configuration -->
    <max_concurrent_queries>100</max_concurrent_queries>
    <max_connections>4096</max_connections>

    <!-- 内存限制 / Memory Limits -->
    <max_memory_usage>3000000000</max_memory_usage>
    <max_memory_usage_for_all_queries>4000000000</max_memory_usage_for_all_queries>

    <!-- 压缩配置 / Compression Configuration -->
    <compression>
        <case>
            <min_part_size>10000000000</min_part_size>
            <min_part_size_ratio>0.01</min_part_size_ratio>
            <method>lz4</method>
        </case>
    </compression>

    <!-- 合并配置 / Merge Configuration -->
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
        <parts_to_delay_insert>150</parts_to_delay_insert>
        <parts_to_throw_insert>300</parts_to_throw_insert>
        <max_delay_to_insert>1</max_delay_to_insert>
    </merge_tree>
</clickhouse>
