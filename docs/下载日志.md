● 有两种方式：

  方式1: 导出 Docker 日志到文件

  # 导出所有5个容器的日志
  mkdir -p docker-logs
  docker logs quant-trend-core > docker-logs/trend-core.log 2>&1
  docker logs quant-tech-alpha > docker-logs/tech-alpha.log 2>&1
  docker logs quant-cross-factor > docker-logs/cross-factor.log 2>&1
  docker logs quant-event-risk > docker-logs/event-risk.log 2>&1
  docker logs quant-hf-arbitrage > docker-logs/hf-arbitrage.log 2>&1

  # 打包下载
  tar -czvf docker-logs.tar.gz docker-logs/
  

  方式2: 日志已挂载到宿主机 ./logs/ 目录

  # 直接打包挂载的日志目录
  tar -czvf app-logs.tar.gz logs/

  然后用 scp 下载到本地：

  # 在本地执行
  scp suqunhau@<服务器IP>:~/projects/new-quant-trading-system-js/docker-logs.tar.gz .

  

  # 1. 重新构建基础镜像（包含你修改的200根K线代码）
  docker build -t quant-trading-system:latest --no-cache .

  # 2. 停止旧容器
  docker compose -f ./docker-compose.multi-strategy.yml down

  # 3. 启动新容器
  docker compose -f ./docker-compose.multi-strategy.yml up -d


  mkdir -p docker-logs; docker logs quant-trend-core > docker-logs/trend-core.log 2>&1; docker logs quant-tech-alpha > docker-logs/tech-alpha.log 2>&1; docker logs quant-cross-factor > docker-logs/cross-factor.log 2>&1; docker logs quant-event-risk > docker-logs/event-risk.log 2>&1; docker logs quant-hf-arbitrage > docker-logs/hf-arbitrage.log 2>&1; tar -czvf docker-logs.tar.gz docker-logs

  mkdir -p docker-logs && for dir in logs/*/; do name=$(basename "$dir"); docker logs "quant-${name}" > "docker-logs/${name}.log" 2>&1 || echo "Container quant-${name} not found"; done && tar -czvf docker-logs.tar.gz docker-logs

  ● 我来为你创建一个单策略的 docker-compose 配置文件：

● Write(docker-compose.single-strategy.yml)
  ⎿  Wrote 1 lines to docker-compose.single-strategy.yml
     # =============================================================================
     # Docker Compose - 单策略部署配置 (使用宿主机Redis/ClickHouse)
     # Single-Strategy Deployment Configuration (Using Host Redis/ClickHouse)
     #
     # 运行单个策略实例，适合测试或小规模部署
     # Run a single strategy instance, suitable for testing or small-scale deployment
     # =============================================================================
     services:
       # ===========================================================================

● 已创建 docker-compose.single-strategy.yml，主要特点：

  - 单实例部署：只包含一个 quant-single 服务
  - 灵活配置：策略名、交易对、时间周期等都支持环境变量覆盖
  - 默认配置：SMA策略，BTC/ETH交易对，1h周期
  - 端口：3000 (HTTP)、9100 (Metrics)、8000 (WebSocket)

  使用方式：

  # 默认启动 (SMA策略)
  docker-compose -f docker-compose.single-strategy.yml up -d

  # 指定策略启动
  STRATEGY_NAME=RSI docker-compose -f docker-compose.single-strategy.yml up -d

  # 自定义完整配置
  STRATEGY_NAME=MACD DEFAULT_SYMBOLS="SOL/USDT:USDT" DEFAULT_TIMEFRAME=4h \
    docker-compose -f docker-compose.single-strategy.yml up -d


  ● 完成了！现在使用非常简单：

  使用方法

   # 赋予执行权限
  chmod +x start-all-strategies.sh

  # 启动全部
  ./start-all-strategies.sh up

  # 停止全部
  ./start-all-strategies.sh down

  # 重启全部
  ./start-all-strategies.sh restart

  # 查看状态
  ./start-all-strategies.sh ps

  # 查看日志
  ./start-all-strategies.sh logs

  docker ps

  docker compose ls

  修改说明

  1. docker-compose.single-strategy.yml - 容器名/端口/目录都改成用 ${STRATEGY_NAME} 变量
  2. start-all-strategies.bat - 自动循环启动，端口自动递增避免冲突：
    - SMA: 3000/9100/8000
    - RSI: 3001/9101/8001
    - MACD: 3002/9102/8002
    - ... 以此类推

  如果只想启动部分策略

  修改脚本第12行的 STRATEGIES 列表即可：
  set STRATEGIES=SMA RSI MACD

  或者单独启动某个：
  set STRATEGY_NAME=RSI&& set PORT=3001&& docker-compose -f docker-compose.single-strategy.yml -p quant-RSI up -d

  chmod +x start-all-strategies.sh
  



    方式一：使用智能启动脚本（推荐）

  # 启动多策略 (自动检测并启动行情服务)
  ./scripts/start-with-shared-market.sh multi

  # 启动单策略
  STRATEGY_NAME=SMA ./scripts/start-with-shared-market.sh single

  # 仅启动行情服务
  ./scripts/start-with-shared-market.sh market-only

  # 查看状态
  ./scripts/start-with-shared-market.sh status

  # 停止所有服务
  ./scripts/start-with-shared-market.sh stop

  方式二：使用 Docker Compose 直接启动

  # 共享行情模式 (同时启动行情服务)
  USE_SHARED_MARKET_DATA=true docker compose -f docker-compose.multi-strategy.yml --profile market-data up -d

  # 如果行情服务已在其他地方运行
  USE_SHARED_MARKET_DATA=true docker compose -f docker-compose.multi-strategy.yml up -d

  # 独立模式 (每个容器自己连接行情)
  docker compose -f docker-compose.multi-strategy.yml up -d


  
  # 修改文件

  | 文件                                | 修改内容                                                                                              | 
  |-------------------------------------|-------------------------------------------------------------------------------------------------------| 
  | src/services/index.js               | 添加 NotificationService、NotificationClient 导出                                                     | 
  | docker-compose.multi-strategy.yml   | 添加 notification-service (profile: notification)，添加 USE_SHARED_NOTIFICATION 环境变量              | 
  | docker-compose.single-strategy.yml  | 同上                                                                                                  | 
  | scripts/start-with-shared-market.sh | 支持 notification-only、services-only 模式，添加 --force-restart-notification、--no-notification 选项 | 

  使用方式

  # 启动所有共享服务 (行情 + 通知)
  ./scripts/start-with-shared-market.sh services-only

  # 仅启动通知服务
  ./scripts/start-with-shared-market.sh notification-only

  # 启动多策略 (自动启动共享行情+通知)
  ./scripts/start-with-shared-market.sh multi

  # 启动但不使用共享通知
  ./scripts/start-with-shared-market.sh multi --no-notification

  # 查看服务状态
  ./scripts/start-with-shared-market.sh status

  架构

  ┌─────────────────────────────────────────────────────┐
  │         NotificationService (独立进程)               │
  │              notification-service.js                 │
  ├─────────────────────────────────────────────────────┤
  │  • 订阅 Redis 频道: notification:request             │
  │  • 单一 Telegram Bot 连接                           │
  │  • 消息队列 + 限流 (1条/秒, 20条/分钟)               │
  │  • 心跳: notification:service:heartbeat              │
  └─────────────────────────────────────────────────────┘
                            ▲
                            │ Redis Pub/Sub
                            │
  ┌──────────────┬──────────┴───────┬──────────────────┐
  │  Strategy A  │    Strategy B    │    Strategy C    │
  │              │                  │                  │
  │ NotificationClient              │                  │
  │ (发送通知请求)                  │                  │
  └──────────────┴──────────────────┴──────────────────┘

  资源节省: N 个策略容器从 N 个 Telegram Bot 连接 → 1 个共享连接。