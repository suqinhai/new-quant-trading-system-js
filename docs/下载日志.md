
  # 1. 重新构建基础镜像（包含你修改的200根K线代码）
  docker build -t quant-trading-system:latest --no-cache .

  # 2. 停止旧容器
  docker compose -f ./docker-compose.multi-strategy.yml down

  # 3. 启动新容器
  docker compose -f ./docker-compose.multi-strategy.yml up -d


  ./start-all-strategies.sh down;./scripts/start-with-shared-market.sh stop;rm -rf docker-logs/ docker-logs.tar.gz;sudo rm -rf logs/ data/;git pull;git add .;git commit -m 'x';git push;docker build -t quant-trading-system:latest --no-cache .;./start-all-strategies.sh up;./scripts/start-with-shared-market.sh multi;sleep 60 && mkdir -p docker-logs && for dir in logs/*/; do name=$(basename "$dir"); docker logs "quant-${name}" > "docker-logs/${name}.log" 2>&1 || echo "Container quant-${name} not found"; done && tar -czvf docker-logs.tar.gz docker-logs;git pull;git add .;git commit -m 'x';git push;


  # 默认启动 (SMA策略)
  docker-compose -f docker-compose.single-strategy.yml up -d

  # 指定策略启动
  STRATEGY_NAME=RSI docker-compose -f docker-compose.single-strategy.yml up -d

  # 自定义完整配置
  STRATEGY_NAME=MACD DEFAULT_SYMBOLS="SOL/USDT:USDT" DEFAULT_TIMEFRAME=4h \
    docker-compose -f docker-compose.single-strategy.yml up -d


  ● 完成了！现在使用非常简单：

  使用方法

   # 赋予执行权限
  chmod +x start-all-strategies.sh

  # 启动全部
  ./start-all-strategies.sh up

  # 停止全部
  ./start-all-strategies.sh down

  # 重启全部
  ./start-all-strategies.sh restart

  # 查看状态
  ./start-all-strategies.sh ps

  # 查看日志
  ./start-all-strategies.sh logs

  docker ps

  docker compose ls

  chmod +x start-all-strategies.sh

  # 启动多策略 (自动检测并启动行情服务)
  ./scripts/start-with-shared-market.sh multi

  # 启动单策略
  STRATEGY_NAME=SMA ./scripts/start-with-shared-market.sh single

  # 仅启动行情服务
  ./scripts/start-with-shared-market.sh market-only

  # 查看状态
  ./scripts/start-with-shared-market.sh status

  # 停止所有服务
  ./scripts/start-with-shared-market.sh stop

  方式二：使用 Docker Compose 直接启动

  # 共享行情模式 (同时启动行情服务)
  USE_SHARED_MARKET_DATA=true docker compose -f docker-compose.multi-strategy.yml --profile market-data up -d

  # 如果行情服务已在其他地方运行
  USE_SHARED_MARKET_DATA=true docker compose -f docker-compose.multi-strategy.yml up -d

  # 独立模式 (每个容器自己连接行情)
  docker compose -f docker-compose.multi-strategy.yml up -d


  
  # 修改文件

  | 文件                                | 修改内容                                                                                              | 
  |-------------------------------------|-------------------------------------------------------------------------------------------------------| 
  | src/services/index.js               | 添加 NotificationService、NotificationClient 导出                                                     | 
  | docker-compose.multi-strategy.yml   | 添加 notification-service (profile: notification)，添加 USE_SHARED_NOTIFICATION 环境变量              | 
  | docker-compose.single-strategy.yml  | 同上                                                                                                  | 
  | scripts/start-with-shared-market.sh | 支持 notification-only、services-only 模式，添加 --force-restart-notification、--no-notification 选项 | 

  使用方式

  # 启动所有共享服务 (行情 + 通知)
  ./scripts/start-with-shared-market.sh services-only

  # 仅启动通知服务
  ./scripts/start-with-shared-market.sh notification-only

  # 启动多策略 (自动启动共享行情+通知)
  ./scripts/start-with-shared-market.sh multi

  # 启动但不使用共享通知
  ./scripts/start-with-shared-market.sh multi --no-notification

  # 查看服务状态
  ./scripts/start-with-shared-market.sh status

  架构

  ┌─────────────────────────────────────────────────────┐
  │         NotificationService (独立进程)               │
  │              notification-service.js                 │
  ├─────────────────────────────────────────────────────┤
  │  • 订阅 Redis 频道: notification:request             │
  │  • 单一 Telegram Bot 连接                           │
  │  • 消息队列 + 限流 (1条/秒, 20条/分钟)               │
  │  • 心跳: notification:service:heartbeat              │
  └─────────────────────────────────────────────────────┘
                            ▲
                            │ Redis Pub/Sub
                            │
  ┌──────────────┬──────────┴───────┬──────────────────┐
  │  Strategy A  │    Strategy B    │    Strategy C    │
  │              │                  │                  │
  │ NotificationClient              │                  │
  │ (发送通知请求)                  │                  │
  └──────────────┴──────────────────┴──────────────────┘

  资源节省: N 个策略容器从 N 个 Telegram Bot 连接 → 1 个共享连接。