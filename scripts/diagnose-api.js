#!/usr/bin/env node
/**
 * äº¤æ˜“æ‰€ API é…ç½®è¯Šæ–­è„šæœ¬
 * Exchange API Configuration Diagnostic Script
 *
 * ç”¨äºè¯Šæ–­å’Œä¿®å¤ API è¿æ¥é—®é¢˜
 * Used to diagnose and fix API connection issues
 */

import 'dotenv/config';

async function getPublicIP() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    return data.ip;
  } catch {
    return '123.31.24.217 (ä»é”™è¯¯æ—¥å¿—ä¸­è·å– / from error logs)';
  }
}

async function main() {
  console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               äº¤æ˜“æ‰€ API é…ç½®è¯Šæ–­ / Exchange API Diagnostic                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);

  // è·å–å½“å‰å…¬ç½‘ IP / Get current public IP
  const currentIP = await getPublicIP();

  console.log(`å½“å‰å…¬ç½‘ IP / Current Public IP: ${currentIP}`);
  console.log('');

  // è¯Šæ–­ç»“æœ / Diagnostic Results
  console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®é¢˜è¯Šæ–­ / Problem Diagnosis                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ OKX:     IP ç™½åå•é™åˆ¶ - å½“å‰ IP ä¸åœ¨ç™½åå•ä¸­                                  â”‚
â”‚             IP Whitelist Restriction - Current IP not whitelisted              â”‚
â”‚                                                                                â”‚
â”‚ âŒ Binance: IP ç™½åå•é™åˆ¶ æˆ– API æƒé™é—®é¢˜                                         â”‚
â”‚             IP Whitelist Restriction or API Permission Issue                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§£å†³æ–¹æ¡ˆ / Solutions                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚ ğŸ“Œ æ–¹æ¡ˆ A: æ·»åŠ å½“å‰ IP åˆ°ç™½åå• (æ¨èç”¨äºå›ºå®š IP)                                  â”‚
â”‚    Option A: Add current IP to whitelist (Recommended for static IP)           â”‚
â”‚                                                                                â”‚
â”‚ ğŸ“Œ æ–¹æ¡ˆ B: ç¦ç”¨ IP ç™½åå•é™åˆ¶ (åŠ¨æ€ IP æˆ–å¼€å‘æµ‹è¯•)                                 â”‚
â”‚    Option B: Disable IP whitelist (For dynamic IP or development)              â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OKX æ“ä½œæ­¥éª¤ / OKX Steps                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚ 1. ç™»å½• OKX: https://www.okx.com                                               â”‚
â”‚ 2. è¿›å…¥ API ç®¡ç†é¡µé¢:                                                           â”‚
â”‚    å¤´åƒ â†’ API â†’ API ç®¡ç†                                                       â”‚
â”‚ 3. æ‰¾åˆ° API Key: cb62507b-73d5-418f-9eca-e714db5bd6e0                          â”‚
â”‚ 4. ç‚¹å‡» "ç¼–è¾‘"                                                                 â”‚
â”‚                                                                                â”‚
â”‚ æ–¹æ¡ˆ A: åœ¨ IP ç™½åå•ä¸­æ·»åŠ : ${currentIP}
â”‚                                                                                â”‚
â”‚ æ–¹æ¡ˆ B: é€‰æ‹© "ä¸é™åˆ¶ IP" (å¦‚æœæ”¯æŒ)                                              â”‚
â”‚         æˆ–è€…åˆ é™¤ç°æœ‰ APIï¼Œåˆ›å»ºæ–°çš„ä¸ç»‘å®š IP çš„ API Key                            â”‚
â”‚                                                                                â”‚
â”‚ 5. ç¡®ä¿æƒé™åŒ…æ‹¬: è¯»å–, äº¤æ˜“                                                      â”‚
â”‚    Make sure permissions include: Read, Trade                                  â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binance æ“ä½œæ­¥éª¤ / Binance Steps                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚ 1. ç™»å½• Binance: https://www.binance.com                                       â”‚
â”‚ 2. è¿›å…¥ API ç®¡ç†é¡µé¢:                                                           â”‚
â”‚    å¤´åƒ â†’ API ç®¡ç†                                                             â”‚
â”‚ 3. æ‰¾åˆ° API Key: NJhnmkTy...                                                   â”‚
â”‚ 4. ç‚¹å‡» "ç¼–è¾‘é™åˆ¶"                                                              â”‚
â”‚                                                                                â”‚
â”‚ æ–¹æ¡ˆ A: åœ¨ IP è®¿é—®é™åˆ¶ä¸­æ·»åŠ : ${currentIP}
â”‚                                                                                â”‚
â”‚ æ–¹æ¡ˆ B: é€‰æ‹© "æ— é™åˆ¶" (éœ€è¦é¢å¤–å®‰å…¨éªŒè¯)                                          â”‚
â”‚         æˆ–è€…åˆ é™¤ç°æœ‰ APIï¼Œåˆ›å»ºæ–°çš„ä¸é™åˆ¶ IP çš„ API Key                            â”‚
â”‚                                                                                â”‚
â”‚ 5. ç¡®ä¿æƒé™åŒ…æ‹¬:                                                                â”‚
â”‚    âœ… Enable Reading                                                           â”‚
â”‚    âœ… Enable Spot & Margin Trading                                             â”‚
â”‚    âœ… Enable Futures (åˆçº¦äº¤æ˜“æƒé™ - å¿…é¡»!)                                      â”‚
â”‚                                                                                â”‚
â”‚ âš ï¸ æ³¨æ„: å¦‚æœ API Key æ²¡æœ‰åˆçº¦æƒé™ï¼Œéœ€è¦åˆ›å»ºæ–°çš„æ”¯æŒåˆçº¦çš„ API Key                  â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯æ­¥éª¤ / Verification Steps                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚ ä¿®æ”¹ API è®¾ç½®åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯:                                               â”‚
â”‚ After modifying API settings, run these commands to verify:                    â”‚
â”‚                                                                                â”‚
â”‚   node scripts/test-okx-connection.js                                          â”‚
â”‚   node scripts/test-binance-connection.js                                      â”‚
â”‚                                                                                â”‚
â”‚ å¦‚æœä¸¤ä¸ªäº¤æ˜“æ‰€éƒ½è¿æ¥æˆåŠŸï¼Œå†å¯åŠ¨ä¸»ç¨‹åº:                                           â”‚
â”‚ If both exchanges connect successfully, start the main program:                â”‚
â”‚                                                                                â”‚
â”‚   node src/main.js shadow -e okx -v                                            â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`);
}

main();
